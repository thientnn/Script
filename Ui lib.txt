-- RoUI Library
-- A comprehensive, mobile-friendly Roblox UI library

local RoUI = {}
RoUI.__index = RoUI

-- Constants
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Utility Functions
local function Tween(instance, properties, duration, easingStyle, easingDirection)
    local tInfo = TweenInfo.new(
        duration or 0.3, 
        easingStyle or Enum.EasingStyle.Quad, 
        easingDirection or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(instance, tInfo, properties)
    tween:Play()
    return tween
end
function RoUI:SetupDragging()
    -- Make UI draggable (PC and Mobile)
    local isDragging = false
    local dragStart
    local startPos
    local gui = self.MainFrame
    local dragArea = self.TitleBar
    
    -- Function to update drag position with screen boundaries
    local function UpdateDragPosition(input)
        local delta = input.Position - dragStart
        local newPosition = UDim2.new(
            startPos.X.Scale, 
            math.clamp(startPos.X.Offset + delta.X, 0, gui.Parent.AbsoluteSize.X - gui.AbsoluteSize.X), 
            startPos.Y.Scale, 
            math.clamp(startPos.Y.Offset + delta.Y, 0, gui.Parent.AbsoluteSize.Y - gui.AbsoluteSize.Y)
        )
        gui.Position = newPosition
    end
    
    -- PC and Mobile input handling
    dragArea.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or 
            input.UserInputType == Enum.UserInputType.Touch) then
            isDragging = true
            dragStart = input.Position
            startPos = gui.Position
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or 
            input.UserInputType == Enum.UserInputType.Touch) then
            isDragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or 
                          input.UserInputType == Enum.UserInputType.Touch) then
            UpdateDragPosition(input)
        end
    end)
    
    -- Add visual feedback when dragging
    dragArea.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            Tween(dragArea, {BackgroundColor3 = Color3.fromRGB(
                math.min(self.Theme.Secondary.R * 255 + 15, 255),
                math.min(self.Theme.Secondary.G * 255 + 15, 255),
                math.min(self.Theme.Secondary.B * 255 + 15, 255)
            ) / 255}, 0.2)
        end
    end)
    
    dragArea.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            Tween(dragArea, {BackgroundColor3 = self.Theme.Secondary}, 0.2)
        end
    end)
end
local function CreateInstance(className, properties)
    local instance = Instance.new(className)
    for property, value in pairs(properties) do
        instance[property] = value
    end
    return instance
end

local function IsMobile()
    return UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled and not UserInputService.MouseEnabled
end

-- Main Library
function RoUI.new(title, theme)
    local self = setmetatable({}, RoUI)
    self.Theme = theme or {
        Background = Color3.fromRGB(30, 30, 30),
        Secondary = Color3.fromRGB(45, 45, 45),
        Accent = Color3.fromRGB(65, 105, 225),
        Text = Color3.fromRGB(255, 255, 255),
        StrokeColor = Color3.fromRGB(80, 80, 80),
        ElementBackground = Color3.fromRGB(40, 40, 40)
    }
    self.IsMobile = IsMobile()
    self.Tabs = {}
    self.ActiveTab = nil
    self.Minimized = false
    self.Visible = false
    
    -- Create ScreenGui
    self.ScreenGui = CreateInstance("ScreenGui", {
        Name = "RoUI",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        Parent = game.CoreGui
    })
    
    -- Create Main Frame
    self.MainFrame = CreateInstance("Frame", {
        Name = "MainFrame",
        Size = UDim2.new(0, self.IsMobile and 300 or 500, 0, self.IsMobile and 400 or 350),
        Position = UDim2.new(0.5, -250, 0.5, -175),
        BackgroundColor3 = self.Theme.Background,
        BorderSizePixel = 0,
        Active = true,
        Parent = self.ScreenGui,
        Visible = false -- Start hidden for open animation
    })
    
    -- Setup dragging
    self:SetupDragging()
    
    -- Corner rounding
    local uiCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.MainFrame
    })
    
    -- Title Bar
    self.TitleBar = CreateInstance("Frame", {
        Name = "TitleBar",
        Size = UDim2.new(1, 0, 0, 30),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = self.Theme.Secondary,
        BorderSizePixel = 0,
        Parent = self.MainFrame
    })
    
    local titleBarCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 6),
        Parent = self.TitleBar
    })
    
    -- Fix the corner rounding for the title bar
    local titleBarFix = CreateInstance("Frame", {
        Name = "CornerFix",
        Size = UDim2.new(1, 0, 0.5, 0),
        Position = UDim2.new(0, 0, 0.5, 0),
        BackgroundColor3 = self.Theme.Secondary,
        BorderSizePixel = 0,
        Parent = self.TitleBar
    })
    
    -- Title Text
    self.TitleText = CreateInstance("TextLabel", {
        Name = "TitleText",
        Size = UDim2.new(1, -100, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = title or "RoUI Library",
        TextColor3 = self.Theme.Text,
        TextSize = 16,
        Font = Enum.Font.SourceSansBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = self.TitleBar
    })
    
    -- Minimize Button
    self.MinimizeButton = CreateInstance("TextButton", {
        Name = "MinimizeButton",
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(1, -55, 0, 3),
        BackgroundTransparency = 1,
        Text = "−",
        TextColor3 = self.Theme.Text,
        TextSize = 20,
        Font = Enum.Font.SourceSansBold,
        Parent = self.TitleBar
    })
    
    self.MinimizeButton.MouseButton1Click:Connect(function()
        self:ToggleMinimize()
    end)
    
    -- Close Button
    self.CloseButton = CreateInstance("TextButton", {
        Name = "CloseButton",
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(1, -27, 0, 3),
        BackgroundTransparency = 1,
        Text = "×",
        TextColor3 = self.Theme.Text,
        TextSize = 20,
        Font = Enum.Font.SourceSansBold,
        Parent = self.TitleBar
    })
    
    self.CloseButton.MouseButton1Click:Connect(function()
        self:Close()
    end)
    
    -- Content Container
    self.Container = CreateInstance("Frame", {
        Name = "Container",
        Size = UDim2.new(1, 0, 1, -30),
        Position = UDim2.new(0, 0, 0, 30),
        BackgroundColor3 = self.Theme.Background,
        BorderSizePixel = 0,
        ClipsDescendants = true,
        Parent = self.MainFrame
    })
    
    -- Tab Bar
    self.TabBar = CreateInstance("Frame", {
        Name = "TabBar",
        Size = UDim2.new(1, 0, 0, 35),
        Position = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = self.Theme.Secondary,
        BorderSizePixel = 0,
        Parent = self.Container
    })
    
    -- Tab Button Container (Scrolling Frame for many tabs)
    self.TabButtonContainer = CreateInstance("ScrollingFrame", {
        Name = "TabButtonContainer",
        Size = UDim2.new(1, 0, 1, 0),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 2,
        ScrollingDirection = Enum.ScrollingDirection.X,
        AutomaticCanvasSize = Enum.AutomaticSize.X,
        Parent = self.TabBar
    })
    
    -- Tab Content Container
    self.TabContentContainer = CreateInstance("Frame", {
        Name = "TabContentContainer",
        Size = UDim2.new(1, 0, 1, -35),
        Position = UDim2.new(0, 0, 0, 35),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = self.Container
    })
    
    -- Tab Button Layout
    local tabButtonLayout = CreateInstance("UIListLayout", {
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Left,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5),
        Parent = self.TabButtonContainer
    })
    
    -- Padding for tab buttons
    local tabButtonPadding = CreateInstance("UIPadding", {
        PaddingLeft = UDim.new(0, 5),
        PaddingRight = UDim.new(0, 5),
        Parent = self.TabButtonContainer
    })
    
    -- Open the UI with animation
    self:Open()
    
    return self
end

function RoUI:SetupDragging()
    -- Make UI draggable (PC only)
    if not self.IsMobile then
        local isDragging = false
        local dragStart
        local startPos
        
        self.TitleBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                isDragging = true
                dragStart = input.Position
                startPos = self.MainFrame.Position
            end
        end)
        
        self.TitleBar.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                isDragging = false
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStart
                self.MainFrame.Position = UDim2.new(
                    startPos.X.Scale, 
                    startPos.X.Offset + delta.X, 
                    startPos.Y.Scale, 
                    startPos.Y.Offset + delta.Y
                )
            end
        end)
    end
end

function RoUI:Open()
    if not self.Visible then
        self.Visible = true
        self.MainFrame.Visible = true
        
        -- Start with scaled down and transparent
        self.MainFrame.Size = UDim2.new(0, 0, 0, 0)
        self.MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        self.MainFrame.BackgroundTransparency = 1
        
        -- Animate to full size
        local targetSize = UDim2.new(0, self.IsMobile and 300 or 500, 0, self.IsMobile and 400 or 350)
        local targetPos = UDim2.new(0.5, -250, 0.5, -175)
        
        Tween(self.MainFrame, {
            Size = targetSize,
            Position = targetPos,
            BackgroundTransparency = 0
        }, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
    end
end

function RoUI:Close()
    if self.Visible then
        -- Animate closing
        Tween(self.MainFrame, {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            BackgroundTransparency = 1
        }, 0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In).Completed:Connect(function()
            self.MainFrame.Visible = false
            self.Visible = false
        end)
    end
end

function RoUI:ToggleMinimize()
    self.Minimized = not self.Minimized
    
    if self.Minimized then
        -- Store current size for later
        self.ExpandedSize = self.MainFrame.Size
        
        -- Animate to minimized state (just title bar)
        Tween(self.MainFrame, {
            Size = UDim2.new(0, self.IsMobile and 300 or 500, 0, 30)
        }, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        
        -- Change minimize button to maximize
        self.MinimizeButton.Text = "+"
    else
        -- Animate back to full size
        Tween(self.MainFrame, {
            Size = self.ExpandedSize
        }, 0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        
        -- Change button back
        self.MinimizeButton.Text = "−"
    end
end

function RoUI:AddTab(name, icon)
    local tab = {}
    tab.Name = name
    tab.Icon = icon
    tab.Elements = {}
    
    -- Create Tab Button
    tab.Button = CreateInstance("TextButton", {
        Name = name .. "Button",
        Size = UDim2.new(0, self.IsMobile and 80 or 100, 1, -10),
        BackgroundColor3 = self.Theme.ElementBackground,
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false,
        Parent = self.TabButtonContainer
    })
    
    -- Button Rounding
    local buttonCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = tab.Button
    })
    
    -- Tab Button Icon (if provided)
    if icon then
        tab.IconImage = CreateInstance("ImageLabel", {
            Name = "IconImage",
            Size = UDim2.new(0, 16, 0, 16),
            Position = UDim2.new(0, 10, 0.5, -8),
            BackgroundTransparency = 1,
            Image = icon,
            Parent = tab.Button
        })
        
        tab.ButtonText = CreateInstance("TextLabel", {
            Name = "ButtonText",
            Size = UDim2.new(1, -36, 1, 0),
            Position = UDim2.new(0, 30, 0, 0),
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = self.Theme.Text,
            TextSize = 14,
            Font = Enum.Font.SourceSansSemibold,
            TextXAlignment = Enum.TextXAlignment.Left,
            Parent = tab.Button
        })
    else
        tab.ButtonText = CreateInstance("TextLabel", {
            Name = "ButtonText",
            Size = UDim2.new(1, -10, 1, 0),
            Position = UDim2.new(0, 5, 0, 0),
            BackgroundTransparency = 1,
            Text = name,
            TextColor3 = self.Theme.Text,
            TextSize = 14,
            Font = Enum.Font.SourceSansSemibold,
            TextXAlignment = Enum.TextXAlignment.Center,
            Parent = tab.Button
        })
    end
    
    -- Tab Content Frame
    tab.ContentFrame = CreateInstance("ScrollingFrame", {
        Name = name .. "Content",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ScrollBarThickness = 4,
        ScrollingDirection = Enum.ScrollingDirection.Y,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        Visible = false,
        Parent = self.TabContentContainer
    })
    
    -- Content Padding
    local contentPadding = CreateInstance("UIPadding", {
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10),
        Parent = tab.ContentFrame
    })
    
    -- Content Layout
    tab.ContentLayout = CreateInstance("UIListLayout", {
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
        Parent = tab.ContentFrame
    })
    
    -- Tab Button Click Handler
    tab.Button.MouseButton1Click:Connect(function()
        self:SelectTab(name)
    end)
    
    table.insert(self.Tabs, tab)
    
    -- Select this tab if it's the first one
    if #self.Tabs == 1 then
        self:SelectTab(name)
    end
    
    -- Return tab methods
    return {
        AddButton = function(text, callback)
            return self:AddButton(tab, text, callback)
        end,
        AddToggle = function(text, default, callback)
            return self:AddToggle(tab, text, default, callback)
        end,
        AddDropdown = function(text, options, default, callback)
            return self:AddDropdown(tab, text, options, default, callback)
        end,
        AddSlider = function(text, min, max, default, callback)
            return self:AddSlider(tab, text, min, max, default, callback)
        end,
        AddSection = function(text)
            return self:AddSection(tab, text)
        end,
        AddNote = function(text)
            return self:AddNote(tab, text)
        end
    }
end

function RoUI:SelectTab(name)
    for _, tab in ipairs(self.Tabs) do
        if tab.Name == name then
            tab.ContentFrame.Visible = true
            Tween(tab.Button, {BackgroundColor3 = self.Theme.Accent}, 0.2)
            tab.ButtonText.TextColor3 = Color3.fromRGB(255, 255, 255)
            self.ActiveTab = tab
        else
            tab.ContentFrame.Visible = false
            Tween(tab.Button, {BackgroundColor3 = self.Theme.ElementBackground}, 0.2)
            tab.ButtonText.TextColor3 = self.Theme.Text
        end
    end
end

function RoUI:AddButton(tab, text, callback)
    local button = {}
    
    -- Create Button Container
    button.Container = CreateInstance("Frame", {
        Name = "ButtonContainer",
        Size = UDim2.new(1, 0, 0, 35),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = tab.ContentFrame
    })
    
    -- Create Button
    button.Button = CreateInstance("TextButton", {
        Name = "Button",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = self.Theme.ElementBackground,
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false,
        Parent = button.Container
    })
    
    -- Button Rounding
    local buttonCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = button.Button
    })
    
    -- Button Text
    button.ButtonText = CreateInstance("TextLabel", {
        Name = "ButtonText",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = self.Theme.Text,
        TextSize = 14,
        Font = Enum.Font.SourceSans,
        Parent = button.Button
    })
    
    -- Button Hover & Click Effects
    button.Button.MouseEnter:Connect(function()
        Tween(button.Button, {BackgroundColor3 = Color3.fromRGB(
            math.min(self.Theme.ElementBackground.R * 255 + 20, 255),
            math.min(self.Theme.ElementBackground.G * 255 + 20, 255),
            math.min(self.Theme.ElementBackground.B * 255 + 20, 255)
        ) / 255}, 0.2)
    end)
    
    button.Button.MouseLeave:Connect(function()
        Tween(button.Button, {BackgroundColor3 = self.Theme.ElementBackground}, 0.2)
    end)
    
    button.Button.MouseButton1Down:Connect(function()
        Tween(button.Button, {BackgroundColor3 = self.Theme.Accent}, 0.1)
    end)
    
    button.Button.MouseButton1Up:Connect(function()
        Tween(button.Button, {BackgroundColor3 = self.Theme.ElementBackground}, 0.1)
    end)
    
    button.Button.MouseButton1Click:Connect(function()
        -- Add a ripple effect
        local ripple = CreateInstance("Frame", {
            Name = "Ripple",
            Size = UDim2.new(0, 0, 0, 0),
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            BackgroundTransparency = 0.7,
            AnchorPoint = Vector2.new(0.5, 0.5),
            BorderSizePixel = 0,
            Parent = button.Button
        })
        
        -- Make the ripple circular
        local rippleCorner = CreateInstance("UICorner", {
            CornerRadius = UDim.new(1, 0),
            Parent = ripple
        })
        
        -- Position at click point
        local mousePos = UserInputService:GetMouseLocation()
        local buttonPos = button.Button.AbsolutePosition
        local buttonSize = button.Button.AbsoluteSize
        
        ripple.Position = UDim2.new(0, mousePos.X - buttonPos.X, 0, mousePos.Y - buttonPos.Y)
        
        -- Animate ripple
        local targetSize = UDim2.new(0, math.max(buttonSize.X, buttonSize.Y) * 2, 0, math.max(buttonSize.X, buttonSize.Y) * 2)
        Tween(ripple, {Size = targetSize, BackgroundTransparency = 1}, 0.5)
        
        -- Remove after animation
        task.delay(0.5, function()
            ripple:Destroy()
        end)
        
        if callback then callback() end
    end)
    
    table.insert(tab.Elements, button)
    return button
end

function RoUI:AddToggle(tab, text, default, callback)
    local toggle = {}
    default = default or false
    
    -- Create Toggle Container
    toggle.Container = CreateInstance("Frame", {
        Name = "ToggleContainer",
        Size = UDim2.new(1, 0, 0, 35),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = tab.ContentFrame
    })
    
    -- Create Toggle Background
    toggle.Background = CreateInstance("Frame", {
        Name = "Background",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = self.Theme.ElementBackground,
        BorderSizePixel = 0,
        Parent = toggle.Container
    })
    
    -- Background Rounding
    local backgroundCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = toggle.Background
    })
    
    -- Toggle Text
    toggle.Text = CreateInstance("TextLabel", {
        Name = "ToggleText",
        Size = UDim2.new(1, -60, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = self.Theme.Text,
        TextSize = 14,
        Font = Enum.Font.SourceSans,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = toggle.Background
    })
    
    -- Toggle Switch Background
    toggle.SwitchBG = CreateInstance("Frame", {
        Name = "SwitchBackground",
        Size = UDim2.new(0, 40, 0, 20),
        Position = UDim2.new(1, -50, 0.5, -10),
        BackgroundColor3 = Color3.fromRGB(60, 60, 60),
        BorderSizePixel = 0,
        Parent = toggle.Background
    })
    
    -- Switch BG Rounding
    local switchBGCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = toggle.SwitchBG
    })
    
    -- Toggle Switch Knob
    toggle.Knob = CreateInstance("Frame", {
        Name = "Knob",
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(0, 2, 0.5, -8),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0,
        Parent = toggle.SwitchBG
    })
    
    -- Knob Rounding
    local knobCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = toggle.Knob
    })
    
    -- Toggle State
    toggle.Value = default
    
    -- Update visual state based on default value
    if default then
        toggle.SwitchBG.BackgroundColor3 = self.Theme.Accent
        toggle.Knob.Position = UDim2.new(1, -18, 0.5, -8)
    end
    
    -- Toggle Click Handler
    toggle.Background.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            toggle.Value = not toggle.Value
            
            if toggle.Value then
                Tween(toggle.SwitchBG, {BackgroundColor3 = self.Theme.Accent}, 0.2)
                Tween(toggle.Knob, {Position = UDim2.new(1, -18, 0.5, -8)}, 0.2)
            else
                Tween(toggle.SwitchBG, {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}, 0.2)
                Tween(toggle.Knob, {Position = UDim2.new(0, 2, 0.5, -8)}, 0.2)
            end
            
            if callback then callback(toggle.Value) end
        end
    end)
    
    -- Create API
    toggle.SetValue = function(value)
        toggle.Value = value
        
        if value then
            Tween(toggle.SwitchBG, {BackgroundColor3 = self.Theme.Accent}, 0.2)
            Tween(toggle.Knob, {Position = UDim2.new(1, -18, 0.5, -8)}, 0.2)
        else
            Tween(toggle.SwitchBG, {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}, 0.2)
            Tween(toggle.Knob, {Position = UDim2.new(0, 2, 0.5, -8)}, 0.2)
        end
        
        if callback then callback(toggle.Value) end
    end
    
    table.insert(tab.Elements, toggle)
    return toggle
end

function RoUI:AddDropdown(tab, text, options, default, callback)
    local dropdown = {}
    options = options or {}
    dropdown.Options = options
    dropdown.Value = default or (options[1] or "")
    dropdown.Open = false
    
    -- Create Dropdown Container
    dropdown.Container = CreateInstance("Frame", {
        Name = "DropdownContainer",
        Size = UDim2.new(1, 0, 0, 35),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        ClipsDescendants = true,
        ZIndex = 10, -- Ensure dropdown appears above other elements
        Parent = tab.ContentFrame
    })
    
    -- Create Dropdown Header
    dropdown.Header = CreateInstance("Frame", {
        Name = "Header",
        Size = UDim2.new(1, 0, 0, 35),
        BackgroundColor3 = self.Theme.ElementBackground,
        BorderSizePixel = 0,
        ZIndex = 10,
        Parent = dropdown.Container
    })
    
    -- Header Rounding
    local headerCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = dropdown.Header
    })
    
    -- Dropdown Text
    dropdown.Text = CreateInstance("TextLabel", {
        Name = "DropdownText",
        Size = UDim2.new(0.5, 0, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = self.Theme.Text,
        TextSize = 14,
        Font = Enum.Font.SourceSans,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 11,
        Parent = dropdown.Header
    })
    
    -- Selected Value Text
    dropdown.SelectedText = CreateInstance("TextLabel", {
        Name = "SelectedText",
        Size = UDim2.new(0.5, -40, 1, 0),
        Position = UDim2.new(0.5, 0, 0, 0),
        BackgroundTransparency = 1,
        Text = dropdown.Value,
        TextColor3 = self.Theme.Accent,
        TextSize = 14,
        Font = Enum.Font.SourceSans,
        TextXAlignment = Enum.TextXAlignment.Left,
        ZIndex = 11,
        Parent = dropdown.Header
    })
    
    -- Dropdown Arrow
    dropdown.Arrow = CreateInstance("TextLabel", {
        Name = "Arrow",
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(1, -25, 0.5, -10),
        BackgroundTransparency = 1,
        Text = "▼",
        TextColor3 = self.Theme.Text,
        TextSize = 14,
        Font = Enum.Font.SourceSansBold,
        ZIndex = 11,
        Parent = dropdown.Header
    })
    
    -- Dropdown Options List
    dropdown.OptionList = CreateInstance("Frame", {
        Name = "OptionList",
        Size = UDim2.new(1, 0, 0, 0), -- Will be resized based on options
        Position = UDim2.new(0, 0, 0, 35),
        BackgroundColor3 = self.Theme.ElementBackground,
        BorderSizePixel = 0,
        ZIndex = 20, -- Higher Z-index to appear above everything
        Visible = false,
        Parent = dropdown.Container
    })
    
    -- Options List Rounding
    local optionListCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = dropdown.OptionList
    })
    
    -- Options List Layout
    local optionListLayout = CreateInstance("UIListLayout", {
        FillDirection = Enum.FillDirection.Vertical,
        HorizontalAlignment = Enum.HorizontalAlignment.Left,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2),
        Parent = dropdown.OptionList
    })
    
    -- Create option buttons
    dropdown.OptionButtons = {}
    
    local function CreateOptions()
        -- Clear existing options
        for _, button in pairs(dropdown.OptionButtons) do
            button:Destroy()
        end
        dropdown.OptionButtons = {}
        
        if #dropdown.Options == 0 then
            -- Add a placeholder if no options
            local emptyOption = CreateInstance("TextLabel", {
                Name = "EmptyOption",
                Size = UDim2.new(1, 0, 0, 30),
                BackgroundTransparency = 1,
                Text = "No options available",
                TextColor3 = Color3.fromRGB(150, 150, 150),
                TextSize = 14,
                Font = Enum.Font.SourceSans,
                ZIndex = 21,
                Parent = dropdown.OptionList
            })
            
            table.insert(dropdown.OptionButtons, emptyOption)
        else
            -- Create new options
            for i, option in ipairs(dropdown.Options) do
                local optionButton = CreateInstance("TextButton", {
                    Name = "Option_" .. i,
                    Size = UDim2.new(1, 0, 0, 30),
                    BackgroundTransparency = 1,
                    Text = option,
                    TextColor3 = self.Theme.Text,
                    TextSize = 14,
                    Font = Enum.Font.SourceSans,
                    ZIndex = 21,
                    Parent = dropdown.OptionList
                })
                
                -- Highlight the current selection
                if option == dropdown.Value then
                    optionButton.TextColor3 = self.Theme.Accent
                end
                
                optionButton.MouseEnter:Connect(function()
                    if option ~= dropdown.Value then
                        Tween(optionButton, {BackgroundTransparency = 0.9}, 0.2)
                    end
                end)
                
                optionButton.MouseLeave:Connect(function()
                    if option ~= dropdown.Value then
                        Tween(optionButton, {BackgroundTransparency = 1}, 0.2)
                    end
                end)
                
                optionButton.MouseButton1Click:Connect(function()
                    dropdown.Value = option
                    dropdown.SelectedText.Text = option
                    dropdown:Toggle()
                    
                    if callback then callback(option) end
                end)
                
                table.insert(dropdown.OptionButtons, optionButton)
            end
        end
        
        -- Resize option list
        local height = 0
        if #dropdown.Options == 0 then
            height = 30 -- Height for empty message
        else
            height = #dropdown.Options * 30 + (#dropdown.Options - 1) * 2
        end
        
        dropdown.OptionList.Size = UDim2.new(1, 0, 0, height)
        
        -- Update container size if dropdown is open
        if dropdown.Open then
            dropdown.Container.Size = UDim2.new(1, 0, 0, 35 + height)
        end
    end
    
    -- Initial creation of options
    CreateOptions()
    
    -- Toggle dropdown visibility
    dropdown.Toggle = function(self)
        dropdown.Open = not dropdown.Open
        dropdown.OptionList.Visible = dropdown.Open
        
        -- Rotate the arrow
        if dropdown.Open then
            Tween(dropdown.Arrow, {Rotation = 180}, 0.2)
            
            -- Calculate the necessary size to show all options
            local optionListHeight = dropdown.OptionList.Size.Y.Offset
            Tween(dropdown.Container, {
                Size = UDim2.new(1, 0, 0, 35 + optionListHeight)
            }, 0.2)
        else
            Tween(dropdown.Arrow, {Rotation = 0}, 0.2)
            
            -- Shrink back to header size
            Tween(dropdown.Container, {
                Size = UDim2.new(1, 0, 0, 35)
            }, 0.2)
        end
    end
    
    -- Close other dropdowns when a new one is opened
    local function CloseOtherDropdowns(current)
        for _, element in pairs(tab.Elements) do
            if element ~= current and element.Toggle and element.Open then
                element:Toggle()
            end
        end
    end
    
    -- Header click handler
    dropdown.Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            CloseOtherDropdowns(dropdown)
            dropdown:Toggle()
        end
    end)
    
    -- Set options method
    dropdown.SetOptions = function(self, newOptions)
        dropdown.Options = newOptions
        dropdown.Value = newOptions[1] or ""
        dropdown.SelectedText.Text = dropdown.Value
        CreateOptions()
    end
    
    -- Set value method
    dropdown.SetValue = function(self, value)
        if table.find(dropdown.Options, value) then
            dropdown.Value = value
            dropdown.SelectedText.Text = value
            
            -- Update option button colors to reflect selection
            for _, button in pairs(dropdown.OptionButtons) do
                if button.Text == value then
                    button.TextColor3 = self.Theme.Accent
                else
                    button.TextColor3 = self.Theme.Text
                end
            end
            
            if callback then callback(value) end
        end
    end
    
    -- Auto-close dropdown when clicking outside
    UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            local mousePos = UserInputService:GetMouseLocation()
            local headerPos = dropdown.Header.AbsolutePosition
            local headerSize = dropdown.Header.AbsoluteSize
            local optionListPos = dropdown.OptionList.AbsolutePosition
            local optionListSize = dropdown.OptionList.AbsoluteSize
            
            -- Check if click is outside the dropdown
            if dropdown.Open and not (
                mousePos.X >= headerPos.X and mousePos.X <= headerPos.X + headerSize.X and
                mousePos.Y >= headerPos.Y and mousePos.Y <= headerPos.Y + headerSize.Y
            ) and not (
                mousePos.X >= optionListPos.X and mousePos.X <= optionListPos.X + optionListSize.X and
                mousePos.Y >= optionListPos.Y and mousePos.Y <= optionListPos.Y + optionListSize.Y
            ) then
                dropdown:Toggle()
            end
        end
    end)
    
    table.insert(tab.Elements, dropdown)
    return dropdown
end

function RoUI:AddSlider(tab, text, min, max, default, callback)
    local slider = {}
    min = min or 0
    max = max or 100
    default = default or min
    slider.Value = default
    slider.Min = min
    slider.Max = max
    
    -- Create Slider Container
    slider.Container = CreateInstance("Frame", {
        Name = "SliderContainer",
        Size = UDim2.new(1, 0, 0, 50),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = tab.ContentFrame
    })
    
    -- Create Slider Background
    slider.Background = CreateInstance("Frame", {
        Name = "Background",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = self.Theme.ElementBackground,
        BorderSizePixel = 0,
        Parent = slider.Container
    })
    
    -- Background Rounding
    local backgroundCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = slider.Background
    })
    
    -- Slider Text
    slider.Text = CreateInstance("TextLabel", {
        Name = "SliderText",
        Size = UDim2.new(1, -10, 0, 20),
        Position = UDim2.new(0, 10, 0, 5),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = self.Theme.Text,
        TextSize = 14,
        Font = Enum.Font.SourceSans,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = slider.Background
    })
    
    -- Slider Value Text
    slider.ValueText = CreateInstance("TextLabel", {
        Name = "ValueText",
        Size = UDim2.new(0, 50, 0, 20),
        Position = UDim2.new(1, -60, 0, 5),
        BackgroundTransparency = 1,
        Text = tostring(default),
        TextColor3 = self.Theme.Accent,
        TextSize = 14,
        Font = Enum.Font.SourceSans,
        TextXAlignment = Enum.TextXAlignment.Right,
        Parent = slider.Background
    })
    
    -- Slider Track
    slider.Track = CreateInstance("Frame", {
        Name = "Track",
        Size = UDim2.new(1, -20, 0, 6),
        Position = UDim2.new(0, 10, 0, 35),
        BackgroundColor3 = Color3.fromRGB(60, 60, 60),
        BorderSizePixel = 0,
        Parent = slider.Background
    })
    
    -- Track Rounding
    local trackCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = slider.Track
    })
    
    -- Slider Fill
    slider.Fill = CreateInstance("Frame", {
        Name = "Fill",
        Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
        BackgroundColor3 = self.Theme.Accent,
        BorderSizePixel = 0,
        Parent = slider.Track
    })
    
    -- Fill Rounding
    local fillCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = slider.Fill
    })
    
    -- Slider Knob
    slider.Knob = CreateInstance("Frame", {
        Name = "Knob",
        Size = UDim2.new(0, 14, 0, 14),
        Position = UDim2.new((default - min) / (max - min), 0, 0.5, -7),
        AnchorPoint = Vector2.new(0.5, 0),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0,
        Parent = slider.Track
    })
    
    -- Knob Rounding
    local knobCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(1, 0),
        Parent = slider.Knob
    })
    
    -- Slider Interaction
    local isDragging = false
    
    local function UpdateSlider(input)
        local pos = input.Position.X
        local trackStart = slider.Track.AbsolutePosition.X
        local trackEnd = trackStart + slider.Track.AbsoluteSize.X
        local relativePos = math.clamp((pos - trackStart) / (trackEnd - trackStart), 0, 1)
        
        slider.Value = min + relativePos * (max - min)
        slider.Value = math.floor(slider.Value * 10) / 10 -- Round to 1 decimal place
        
        -- Update visual elements
        slider.Fill.Size = UDim2.new(relativePos, 0, 1, 0)
        slider.Knob.Position = UDim2.new(relativePos, 0, 0.5, -7)
        slider.ValueText.Text = tostring(slider.Value)
        
        if callback then callback(slider.Value) end
    end
    
    slider.Track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            UpdateSlider(input)
        end
    end)
    
    slider.Track.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
        end
    end)
    
    -- Improve touch/mobile slider functionality
    slider.Background.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            UpdateSlider(input)
        end
    end)
    
    slider.Background.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) and isDragging then
            UpdateSlider(input)
        end
    end)
    
    -- Add visual feedback when interacting with the slider
    slider.Track.MouseEnter:Connect(function()
        if not isDragging then
            Tween(slider.Knob, {Size = UDim2.new(0, 16, 0, 16), Position = UDim2.new(slider.Knob.Position.X.Scale, 0, 0.5, -8)}, 0.2)
        end
    end)
    
    slider.Track.MouseLeave:Connect(function()
        if not isDragging then
            Tween(slider.Knob, {Size = UDim2.new(0, 14, 0, 14), Position = UDim2.new(slider.Knob.Position.X.Scale, 0, 0.5, -7)}, 0.2)
        end
    end)
    
    -- Set value method
    slider.SetValue = function(self, value)
        value = math.clamp(value, min, max)
        slider.Value = value
        
        local relativePos = (value - min) / (max - min)
        slider.Fill.Size = UDim2.new(relativePos, 0, 1, 0)
        slider.Knob.Position = UDim2.new(relativePos, 0, 0.5, -7)
        slider.ValueText.Text = tostring(value)
        
        if callback then callback(value) end
    end
    
    table.insert(tab.Elements, slider)
    return slider
end

function RoUI:AddSection(tab, text)
    local section = {}
    
    -- Create Section Container
    section.Container = CreateInstance("Frame", {
        Name = "SectionContainer",
        Size = UDim2.new(1, 0, 0, 30),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        Parent = tab.ContentFrame
    })
    
    -- Section Text
    section.Text = CreateInstance("TextLabel", {
        Name = "SectionText",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = self.Theme.Accent,
        TextSize = 16,
        Font = Enum.Font.SourceSansBold,
        TextXAlignment = Enum.TextXAlignment.Left,
        Parent = section.Container
    })
    
    -- Divider Line
    section.Divider = CreateInstance("Frame", {
        Name = "Divider",
        Size = UDim2.new(1, 0, 0, 1),
        Position = UDim2.new(0, 0, 1, -1),
        BackgroundColor3 = self.Theme.StrokeColor,
        BorderSizePixel = 0,
        Parent = section.Container
    })
    
    table.insert(tab.Elements, section)
    return section
end

function RoUI:AddNote(tab, text)
    local note = {}
    
    -- Create Note Container
    note.Container = CreateInstance("Frame", {
        Name = "NoteContainer",
        Size = UDim2.new(1, 0, 0, 0), -- Auto-sized based on text
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        AutomaticSize = Enum.AutomaticSize.Y,
        Parent = tab.ContentFrame
    })
    
    -- Note Background
    note.Background = CreateInstance("Frame", {
        Name = "Background",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = self.Theme.Secondary,
        BorderSizePixel = 0,
        AutomaticSize = Enum.AutomaticSize.Y,
        Parent = note.Container
    })
    
    -- Background Rounding
    local backgroundCorner = CreateInstance("UICorner", {
        CornerRadius = UDim.new(0, 4),
        Parent = note.Background
    })
    
    -- Note Icon
    note.Icon = CreateInstance("TextLabel", {
        Name = "Icon",
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundTransparency = 1,
        Text = "ℹ",
        TextColor3 = self.Theme.Accent,
        TextSize = 18,
        Font = Enum.Font.SourceSansBold,
        Parent = note.Background
    })
    
    -- Note Text
    note.Text = CreateInstance("TextLabel", {
        Name = "NoteText",
        Size = UDim2.new(1, -50, 0, 0),
        Position = UDim2.new(0, 40, 0, 10),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = self.Theme.Text,
        TextSize = 14,
        Font = Enum.Font.SourceSans,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        AutomaticSize = Enum.AutomaticSize.Y,
        Parent = note.Background
    })
    
    -- Note Padding
    local notePadding = CreateInstance("UIPadding", {
        PaddingBottom = UDim.new(0, 10),
        Parent = note.Background
    })
    
    table.insert(tab.Elements, note)
    return note
end

-- Return the library
return RoUI